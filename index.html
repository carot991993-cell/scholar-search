<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>C√¥ng c·ª• T√¨m ki·∫øm & Tr√≠ch xu·∫•t H·ªçc thu·∫≠t C√° nh√¢n</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-50 text-gray-900">

<!-- HEADER -->
<header class="text-center py-8 border-b">
  <h1 class="text-2xl font-semibold text-indigo-700">
    C√¥ng c·ª• T√¨m ki·∫øm & Tr√≠ch xu·∫•t H·ªçc thu·∫≠t C√° nh√¢n
  </h1>
  <p class="mt-1 text-sm text-gray-500">
    Giao di·ªán nghi√™n c·ª©u ki·ªÉu Google Scholar
  </p>
</header>

<!-- MAIN -->
<main class="max-w-7xl mx-auto px-6">

  <div class="grid grid-cols-12 gap-6">

    <!-- FILTER -->
    <aside class="col-span-3 space-y-6">
<!-- PROFILE H·ªåC THU·∫¨T -->
<div class="bg-white p-4 rounded-lg shadow">

  <div class="flex gap-4 items-start">

    <!-- AVATAR -->
    <img
      src="avatar.jpg"
      class="w-16 h-16 rounded-full object-cover border"
      alt="Avatar">

    <!-- INFO -->
    <div class="space-y-2 text-sm leading-relaxed">

      <div>
        <p class="font-semibold text-base text-gray-900">
          Nguy·ªÖn Kim To√°n
        </p>
        <p class="text-gray-600">
          MSc. Business Administration
        </p>
      </div>

      <div class="flex flex-wrap gap-2 text-xs mt-2">
  <span class="bg-gray-100 px-2 py-1 rounded">FDI & Governance</span>
  <span class="bg-gray-100 px-2 py-1 rounded">Digital Transformation</span>
  <span class="bg-gray-100 px-2 py-1 rounded">AI in Management</span>
  <span class="bg-gray-100 px-2 py-1 rounded">Green Tourism</span>
</div>

      <div class="pt-2 space-y-1 text-indigo-600">
        <a href="mailto:carot991993@gmail.com" class="block hover:underline">
          Email
        </a>
        <a href="#" class="block hover:underline">
          Google Scholar
        </a>
      </div>

    </div>
  </div>

</div>
      <div class="bg-white p-4 rounded-lg shadow">
        <h3 class="font-semibold mb-3">Th·ªùi gian</h3>

<div class="space-y-2 text-sm">

  <label class="flex items-center gap-2">
    <input type="radio" name="timeRange" value="any" checked>
    Any time 
  </label>

  <label class="flex items-center gap-2">
    <input type="radio" name="timeRange" value="1">
    1 year
  </label>

  <label class="flex items-center gap-2">
    <input type="radio" name="timeRange" value="5">
    5 years
  </label>

  <label class="flex items-center gap-2">
    <input type="radio" name="timeRange" value="10">
    10 years
  </label>

  <label class="flex items-center gap-2">
    <input type="radio" name="timeRange" value="custom">
    Custom 
  </label>

</div>

<!-- CUSTOM RANGE -->
<div id="customYearBox" class="hidden mt-3 space-y-2 text-sm">
  <div class="flex gap-2">
    <input id="yearFrom" type="number" placeholder="T·ª´ nƒÉm"
           class="w-1/2 border rounded px-2 py-1 text-sm">
    <input id="yearTo" type="number" placeholder="ƒê·∫øn nƒÉm"
           class="w-1/2 border rounded px-2 py-1 text-sm">
  </div>
</div>

        <hr class="my-4">

        <h3 class="font-semibold mb-3">B·ªô l·ªçc K·∫øt qu·∫£</h3>

        <label class="flex items-center gap-2 text-sm mb-2">
          <input type="checkbox" id="hasAbstract"> C√≥ t√≥m t·∫Øt
        </label>

        <label class="flex items-center gap-2 text-sm mb-2">
          <input type="checkbox" id="freeFullText"> To√†n vƒÉn mi·ªÖn ph√≠
        </label>

        <label class="flex items-center gap-2 text-sm mb-2">
          <input type="checkbox" id="medline"> MEDLINE
        </label>

        <label class="flex items-center gap-2 text-sm">
          <input type="checkbox" id="excludePreprint"> Lo·∫°i tr·ª´ Preprints
        </label>
      </div>
<div class="bg-white p-4 rounded-lg shadow">
  <h3 class="font-semibold mb-3">L·ªãch s·ª≠ t√¨m ki·∫øm</h3>
  <ul id="searchHistory"
    class="space-y-2 text-sm text-indigo-600">
  <li class="text-gray-400 italic">
    Ch∆∞a c√≥ t√¨m ki·∫øm n√†o
  </li>
</ul>
</div>
    </aside>

    <!-- SEARCH + RESULT -->
    <section class="col-span-6 space-y-6">

      <div class="flex gap-3 items-center">
        <input id="query" type="text"
               class="flex-1 border rounded px-4 py-2 text-sm"
               placeholder="Nh·∫≠p t·ª´ kh√≥a h·ªçc thu·∫≠t">

        <button onclick="searchScholar()"
                class="bg-indigo-600 text-white px-6 py-3 rounded hover:bg-indigo-700">
          T√¨m ki·∫øm
        </button>

        <select class="border rounded px-3 py-3 text-sm">
          <option>Li√™n quan</option>
          <option>M·ªõi nh·∫•t</option>
        </select>
      </div>

      <div id="loading" class="hidden text-gray-500">
        ƒêang t√¨m ki·∫øm...
      </div>
      <div class="flex gap-3 mb-4">
  <button onclick="exportBibTeX()"
          class="bg-green-600 text-white px-4 py-2 rounded text-sm">
    Xu·∫•t BibTeX
  </button>

  <button onclick="exportCSV()"
          class="bg-blue-600 text-white px-4 py-2 rounded text-sm">
    Xu·∫•t CSV
  </button>
</div>
      <div id="results" class="space-y-4 text-sm text-gray-500">
  <div class="border rounded p-6 bg-white">
    <p class="mb-2 font-medium text-gray-700">
      üëã Ch√†o m·ª´ng b·∫°n
    </p>
    <p>
      Nh·∫≠p t·ª´ kh√≥a h·ªçc thu·∫≠t ƒë·ªÉ b·∫Øt ƒë·∫ßu t√¨m ki·∫øm t√†i li·ªáu nghi√™n c·ª©u.
      K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y.
    </p>
  </div>
</div>

    </section>
<!-- PANEL GHIM -->
<aside class="col-span-3 space-y-4">

  <div class="bg-white p-4 rounded-lg shadow sticky top-6">

    <h3 class="font-semibold mb-3 text-indigo-700">
      ‚≠ê B√†i ƒë√£ ghim
    </h3>
<input
  id="pinnedSearch"
  type="text"
  placeholder="T√¨m trong b√†i ƒë√£ ghim..."
  class="w-full border rounded px-2 py-1 text-sm mb-3"
  oninput="renderPinnedPanel(this.value)">
<button
  onclick="exportPinnedBibTeX()"
  class="mb-3 text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">
  ‚¨á Xu·∫•t BibTeX b√†i ƒë√£ ghim
</button>
<button
  onclick="exportPinnedCSV()"
  class="mb-3 text-xs bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">
  ‚¨á Xu·∫•t CSV b√†i ƒë√£ ghim
</button>
    <div id="pinnedPanel"
         class="space-y-3 text-sm text-gray-700">
      <p class="text-gray-400 italic">
        Ch∆∞a c√≥ b√†i n√†o ƒë∆∞·ª£c ghim
      </p>
    </div>

  </div>

</aside>

  </div>

<!-- FOOTER / EXTRA CONTENT -->
<section class="mt-16 border-t pt-10">

  <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-sm text-gray-700">

    <div>
      <h3 class="font-semibold text-gray-900 mb-3">
        V·ªÅ c√¥ng c·ª•
      </h3>
      <p class="leading-relaxed">
        C√¥ng c·ª• t√¨m ki·∫øm & tr√≠ch xu·∫•t h·ªçc thu·∫≠t c√° nh√¢n,
        h·ªó tr·ª£ t·ªïng quan t√†i li·ªáu, tr√≠ch d·∫´n v√† nghi√™n c·ª©u khoa h·ªçc
        theo phong c√°ch Google Scholar Labs.
      </p>
    </div>

    <div>
      <h3 class="font-semibold text-gray-900 mb-3">
        ·ª®ng d·ª•ng nghi√™n c·ª©u
      </h3>
      <ul class="list-disc list-inside space-y-1">
        <li>T·ªïng quan t√†i li·ªáu (Literature Review)</li>
        <li>Ph√¢n t√≠ch xu h∆∞·ªõng nghi√™n c·ª©u</li>
        <li>Chu·∫©n b·ªã lu·∫≠n vƒÉn, b√†i b√°o</li>
        <li>Xu·∫•t tr√≠ch d·∫´n BibTeX / CSV</li>
      </ul>
    </div>

    <div>
      <h3 class="font-semibold text-gray-900 mb-3">
        L∆∞u √Ω h·ªçc thu·∫≠t
      </h3>
      <p class="leading-relaxed">
        D·ªØ li·ªáu ƒë∆∞·ª£c truy xu·∫•t ph·ª•c v·ª• m·ª•c ƒë√≠ch h·ªçc t·∫≠p v√† nghi√™n c·ª©u.
        Ng∆∞·ªùi d√πng c·∫ßn ki·ªÉm ch·ª©ng l·∫°i ngu·ªìn tr∆∞·ªõc khi tr√≠ch d·∫´n ch√≠nh th·ª©c.
      </p>
    </div>

  </div>

  <div class="mt-10 text-center text-xs text-gray-500">
    ¬© 2025 ‚Äì Personal Academic Search Tool ¬∑ For research & learning
  </div>

</section>
</main>

<!-- SCRIPT -->
<script>
const API_URL = "https://scholar-proxy.tm-b30.workers.dev/";
let LAST_RESULTS = [];
let PINNED_ITEMS = JSON.parse(localStorage.getItem("pinnedItems")) || [];

function showLoading() {
  document.getElementById("loading").classList.remove("hidden");
  document.getElementById("results").innerHTML = "";
}

function hideLoading() {
  document.getElementById("loading").classList.add("hidden");
}
function highlight(text, keyword) {
  if (!keyword) return text;
  return text.replace(
    new RegExp("(" + keyword + ")", "gi"),
    "<mark class='bg-yellow-200'>$1</mark>"
  );
}
function renderResults(items) {
  const container = document.getElementById("results");
  container.innerHTML = "";

  if (!items || items.length === 0) {
    container.innerHTML =
      "<p class='text-gray-500'>Kh√¥ng c√≥ k·∫øt qu·∫£ ph√π h·ª£p.</p>";
    return;
  }

  items.forEach((item, index) => {
    const keyword = document.getElementById("query").value.trim();
    const title = highlight(item.title || "Kh√¥ng ti√™u ƒë·ªÅ", keyword);
    const link = item.link || "#";
    const snippet = highlight(item.snippet || "", keyword);

    const publication =
      item.publication_info?.summary || "";

    const authors =
      item.publication_info?.authors
        ? item.publication_info.authors.map(a => a.name).join(", ")
        : "";

    const cited =
      item.inline_links?.cited_by?.total
        ? `‚≠ê Tr√≠ch d·∫´n: ${item.inline_links.cited_by.total}`
        : "";

    const pdf =
      item.resources && item.resources.length > 0
        ? item.resources.find(r => r.file_format === "PDF")
        : null;
const pinned = isPinned(item.link);

    const div = document.createElement("div");
    div.className = "bg-white p-5 rounded-lg shadow space-y-2 relative";
    div.className = "bg-white p-5 rounded-lg shadow space-y-2";

    div.innerHTML = `
  <div class="flex items-start gap-3">
    <input type="checkbox"
           class="select-item mt-1"
           data-index="${index}">

    <div class="flex-1 space-y-2">
      <h3 class="text-lg font-semibold text-indigo-600">
        <a href="${link}" target="_blank">${title}</a>
      </h3>

      <p class="text-sm text-gray-600">${authors}</p>
      <p class="text-sm text-gray-500">${publication}</p>
      <p class="text-sm text-gray-700">${snippet}</p>

      <div class="flex gap-3 text-xs mt-2">
        ${pdf ? `<span class="bg-green-100 text-green-700 px-2 py-1 rounded">PDF</span>` : ""}
        ${cited ? `<span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded">${cited}</span>` : ""}
        ${snippet ? `<span class="bg-blue-100 text-blue-700 px-2 py-1 rounded">Abstract</span>` : ""}
      </div>

      ${pdf ? `<a href="${pdf.link}" target="_blank" class="text-green-600 text-sm">üìÑ PDF</a>` : ""}
<button
  onclick="togglePin(${index})"
  class="text-xs mt-2 ${pinned ? 'text-yellow-600' : 'text-gray-400'} hover:underline">
  ‚≠ê ${pinned ? 'ƒê√£ ghim' : 'Ghim'}
</button>

    </div>
</div>
    `;

    container.appendChild(div);
  });
}

async function searchScholar() {
  const q = document.getElementById("query").value.trim();
const timeRange = document.querySelector(
  'input[name="timeRange"]:checked'
).value;

let yearFrom = null;
let yearTo = null;

if (timeRange === "custom") {
  yearFrom = document.getElementById("yearFrom").value;
  yearTo = document.getElementById("yearTo").value;
}
  if (!q) {
    alert("Vui l√≤ng nh·∫≠p t·ª´ kh√≥a h·ªçc thu·∫≠t");
    return;
  }

  showLoading();
  saveSearch(q);
  try {
    const res = await fetch(API_URL + "?q=" + encodeURIComponent(q));
    const data = await res.json();
    hideLoading();
    LAST_RESULTS = data.organic_results || [];
    renderResults(LAST_RESULTS);
  } catch (e) {
    hideLoading();
    document.getElementById("results").innerHTML =
      "<p class='text-red-500'>L·ªói khi k·∫øt n·ªëi API.</p>";
  }
}
function saveSearch(keyword) {
  let history = JSON.parse(localStorage.getItem("searchHistory")) || [];

  if (!history.includes(keyword)) {
    history.unshift(keyword);
  }

  history = history.slice(0, 5);
  localStorage.setItem("searchHistory", JSON.stringify(history));
  renderHistory();
}

function renderHistory() {
  const list = document.getElementById("searchHistory");
  if (!list) return;

  const history = JSON.parse(localStorage.getItem("searchHistory")) || [];
  list.innerHTML = "";

  history.forEach(keyword => {
    const li = document.createElement("li");
    li.innerHTML =
      "<a href='#' onclick=\"runFromHistory('" + keyword + "')\">" +
      keyword +
      "</a>";
    list.appendChild(li);
  });
}

function runFromHistory(keyword) {
  document.getElementById("query").value = keyword;
  searchScholar();
}
function getSelectedItems() {
  const checkboxes = document.querySelectorAll(".select-item:checked");
  const results = [];

  checkboxes.forEach(cb => {
    const idx = parseInt(cb.dataset.index);
    if (!isNaN(idx) && LAST_RESULTS[idx]) {
      results.push(LAST_RESULTS[idx]);
    }
  });

  return results;
}

function exportBibTeX() {
  const items = getSelectedItems();

  if (items.length === 0) {
    alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 b√†i ƒë·ªÉ xu·∫•t");
    return;
  }

  let bib = "";
bibtex += "% =====================================\n";
bibtex += "% Exported by: Nguyen Kim Toan\n";
bibtex += "% Personal Academic Scholar Tool\n";
bibtex += "% =====================================\n\n";
  items.forEach((item, i) => {
    const authors =
      item.publication_info?.authors
        ? item.publication_info.authors.map(a => a.name).join(" and ")
        : "Unknown";

    const year =
      item.publication_info?.year || "????";

    bib += `@article{ref${i},
  title={${item.title || ""}},
  author={${authors}},
  year={${year}},
  url={${item.link || ""}}
}\n\n`;
  });

  downloadFile("citations.bib", bib);
}

function exportCSV() {
  const items = getSelectedItems();

  if (items.length === 0) {
    alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 b√†i ƒë·ªÉ xu·∫•t");
    return;
  }

  let csv = "Title,Authors,Year,Link\n";

  items.forEach(item => {
    const title = `"${(item.title || "").replace(/"/g, '""')}"`;
    const authors = `"${item.publication_info?.authors
      ?.map(a => a.name).join("; ") || ""}"`;
    const year = item.publication_info?.year || "";
    const link = item.link || "";

    csv += `${title},${authors},${year},${link}\n`;
  });

  downloadFile("citations.csv", csv);
}

function downloadFile(filename, content) {
  const blob = new Blob([content], { type: "text/plain" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();

  URL.revokeObjectURL(url);
}
document.querySelectorAll('input[name="timeRange"]').forEach(radio => {
  radio.addEventListener("change", () => {
    const customBox = document.getElementById("customYearBox");
    if (radio.value === "custom" && radio.checked) {
      customBox.classList.remove("hidden");
    } else {
      customBox.classList.add("hidden");
    }
  });
});
function togglePin(index) {
  const item = LAST_RESULTS[index];
  if (!item) return;

  const exists = PINNED_ITEMS.find(p => p.link === item.link);

  if (exists) {
    PINNED_ITEMS = PINNED_ITEMS.filter(p => p.link !== item.link);
  } else {
    PINNED_ITEMS.push({
  ...item,
  pinnedAt: new Date().toISOString()
});

  }

  localStorage.setItem("pinnedItems", JSON.stringify(PINNED_ITEMS));
  renderResults(LAST_RESULTS);
renderPinnedPanel();

}

function isPinned(link) {
  return PINNED_ITEMS.some(p => p.link === link);
}
function renderPinnedPanel() {
  const panel = document.getElementById("pinnedPanel");
  if (!panel) return;
  PINNED_ITEMS = JSON.parse(localStorage.getItem("pinnedItems")) || [];
  panel.innerHTML = "";

  if (PINNED_ITEMS.length === 0) {
    panel.innerHTML =
      "<p class='text-gray-400 italic'>Ch∆∞a c√≥ b√†i n√†o ƒë∆∞·ª£c ghim</p>";
    return;
  }

  PINNED_ITEMS.forEach(item => {
    const div = document.createElement("div");
    div.className =
      "border rounded p-2 hover:bg-gray-50 cursor-pointer";

    div.innerHTML = `
  <div class="space-y-2">

    <!-- LINK TI√äU ƒê·ªÄ: CLICK RI√äNG -->
    <a href="${item.link}"
       target="_blank"
       class="block font-medium text-indigo-600 hover:underline">
      ${item.title}
    </a>

    <!-- TH√îNG TIN -->
<p class="text-xs text-gray-500">
  ${item.authors || ""} ¬∑ ${item.year || ""}
</p>

<p class="text-xs text-gray-400">
  üìå Ghim ng√†y: ${item.pinnedAt ? new Date(item.pinnedAt).toLocaleDateString("vi-VN") : ""}
</p>

    <!-- TEXTAREA: ƒê·ªòC L·∫¨P -->
    <input
  type="text"
  class="w-full border rounded px-2 py-1 text-sm"
  placeholder="Nh√£n / Ch·ªß ƒë·ªÅ (VD: L√Ω thuy·∫øt, Th·ª±c nghi·ªám, C·ªët l√µi)"
  onblur="saveTag('${item.link}', this.value)"
  value="${item.tag || ''}">
<textarea
      class="w-full border rounded p-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400"
      placeholder="Ghi ch√∫ c√° nh√¢n..."
      onblur="saveNote('${item.link}', this.value)"
    >${item.note || ""}</textarea>

    <!-- B·ªé GHIM -->
    <button
      onclick="unpinItem('${item.link}')"
      class="text-xs text-red-500 hover:underline">
      B·ªè ghim
    </button>

  </div>
`;

   panel.appendChild(div);
  });
}
renderPinnedPanel();
function saveNote(link, note) {
  let pinned = JSON.parse(localStorage.getItem("pinnedItems")) || [];

  pinned = pinned.map(item => {
    if (item.link === link) {
      return {
        ...item,
        note: note
      };
    }
    return item;
  });

  localStorage.setItem("pinnedItems", JSON.stringify(pinned));
}
function saveTag(link, tag) {
  let pinned = JSON.parse(localStorage.getItem("pinnedItems")) || [];

  pinned = pinned.map(item => {
    if (item.link === link) {
      return { ...item, tag: tag };
    }
    return item;
  });

  localStorage.setItem("pinnedItems", JSON.stringify(pinned));
}
function unpinItem(link) {
  let pinned = JSON.parse(localStorage.getItem("pinnedItems")) || [];

  // LO·∫†I B·ªé B√ÄI C√ì LINK T∆Ø∆†NG ·ª®NG
  pinned = pinned.filter(item => item.link !== link);

  // L∆ØU L·∫†I
  localStorage.setItem("pinnedItems", JSON.stringify(pinned));

  // C·∫¨P NH·∫¨T BI·∫æN TO√ÄN C·ª§C
  PINNED_ITEMS = pinned;

  // V·∫º L·∫†I PANEL + K·∫æT QU·∫¢
  renderPinnedPanel();
  renderResults(LAST_RESULTS);
}
function exportPinnedCSV() {
  const pinned = JSON.parse(localStorage.getItem("pinnedItems")) || [];

  if (pinned.length === 0) {
    alert("Ch∆∞a c√≥ b√†i n√†o ƒë∆∞·ª£c ghim");
    return;
  }

  let csv = "Title,Authors,Year,Link,Pinned Date,Note\n";

  pinned.forEach(item => {
    const title = `"${(item.title || "").replace(/"/g, '""')}"`;
    const authors = `"${(item.authors || "").replace(/"/g, '""')}"`;
    const year = item.year || "";
    const link = item.link || "";
    const pinnedDate = item.pinnedAt
      ? new Date(item.pinnedAt).toLocaleDateString("vi-VN")
      : "";
    const note = `"${(item.note || "").replace(/"/g, '""')}"`;

    csv += `${title},${authors},${year},${link},${pinnedDate},${note}\n`;
  });

  downloadFile("pinned_articles.csv", csv);
}
function exportPinnedBibTeX() {
  const pinned = JSON.parse(localStorage.getItem("pinnedItems")) || [];

  if (pinned.length === 0) {
    alert("Ch∆∞a c√≥ b√†i n√†o ƒë∆∞·ª£c ghim");
    return;
  }

  let bib = "";
  bib += "% Exported from Personal Academic Tool\n\n";

  pinned.forEach((item, i) => {
    const authors = item.publication_info?.authors
      ? item.publication_info.authors.map(a => a.name).join(" and ")
      : "Unknown";

    const year = item.publication_info?.year || "????";

    bib += `@article{pinned${i},
  title={${item.title || ""}},
  author={${authors}},
  year={${year}},
  url={${item.link || ""}}
}\n\n`;
  });

  downloadFile("pinned_articles.bib", bib);
}

</script>

</body>
</html>
